<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>
    <changeSet failOnError="true" id="20230323-001" author="victor">
<!--         <preConditions onFail="MARK_RAN">-->
<!--            <sqlCheck expectedResult="0">-->
<!--                SELECT COUNT(*) FROM case_manager;-->
<!--            </sqlCheck>-->
<!--        </preConditions>-->
        <sql>
            CREATE TABLE IF NOT EXISTS case_manager (
            id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            uuid VARCHAR(255) NOT NULL,
            designation VARCHAR(255),
            first_name VARCHAR(255),
            last_name VARCHAR(255),
            sex VARCHAR(255),
            phone_number VARCHAR(255),
            facility_id INTEGER,
            create_date TIMESTAMP WITHOUT TIME ZONE,
            CONSTRAINT pk_case_manager PRIMARY KEY (id)
            );

            ALTER TABLE case_manager ADD CONSTRAINT uc_case_manager_uuid UNIQUE (uuid);
        </sql>
    </changeSet>
    <changeSet failOnError="true" id="20230323-002" author="victor">
<!--        <preConditions onFail="MARK_RAN">-->
<!--            <sqlCheck expectedResult="0">-->
<!--                SELECT COUNT(*) FROM case_manager_assigned;-->
<!--            </sqlCheck>-->
<!--        </preConditions>-->
        <sql>
            CREATE TABLE IF NOT EXISTS case_manager_assigned (
            id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            assign_date VARCHAR(255),
            case_manager VARCHAR(255),
            state VARCHAR(255),
            lga VARCHAR(255),
            CONSTRAINT pk_case_manager_assigned PRIMARY KEY (id)
            );
        </sql>
    </changeSet>
    <changeSet failOnError="true" id="20230323-003" author="victor">
<!--        <preConditions onFail="MARK_RAN">-->
<!--            <sqlCheck expectedResult="0">-->
<!--                SELECT COUNT(*) FROM case_manager_patients;-->
<!--            </sqlCheck>-->
<!--        </preConditions>-->
        <sql>
            CREATE TABLE IF NOT EXISTS case_manager_patients (
            id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            full_name VARCHAR(255),
            sex VARCHAR(255),
            current_status VARCHAR(255),
            hospital_no VARCHAR(255),
            age VARCHAR(255),
            facility_id VARCHAR(255),
            biometric_status VARCHAR(255),
            person_uuid VARCHAR(255),
            date_of_birth VARCHAR(255),
            case_manager_assigned_id INTEGER,
            CONSTRAINT pk_case_manager_patients PRIMARY KEY (id)
            );

            ALTER TABLE case_manager_patients ADD CONSTRAINT FK_CASE_MANAGER_PATIENTS_ON_CASE_MANAGER_ASSIGNED FOREIGN KEY (case_manager_assigned_id) REFERENCES case_manager_assigned (id);
        </sql>
    </changeSet>
</databaseChangeLog>
